# Story 5.1: Frontend Deployment to Zeabur

## Status
Approved

## Story
**As a** DevOps platform engineer,
**I want** to deploy the JCTOP Event Management frontend application to Zeabur,
**so that** users can access the web interface and interact with the already deployed backend services.

## Acceptance Criteria
1. The frontend application successfully builds for web deployment using Expo SDK 51
2. Static web files are generated and optimized for production deployment
3. The application is deployed to Zeabur and accessible via a public URL
4. All API endpoints correctly connect to the existing backend at https://jctop.zeabur.app/api/v1
5. Authentication flow works end-to-end (login/register/logout functionality)
6. Core user journeys function correctly (event browsing, registration, organizer dashboard)
7. Environment variables are properly configured for production
8. The deployment process is documented and repeatable
9. Health checks and monitoring are in place to verify deployment status
10. SSL/HTTPS is properly configured for secure access

## Tasks / Subtasks
- [ ] Configure Expo Web Build for Production (AC: 1, 2)
  - [ ] Update package.json scripts for proper web export
  - [ ] Configure app.json for web platform support
  - [ ] Fix any Expo CLI version compatibility issues
  - [ ] Test local web build generation
- [ ] Set up Zeabur Deployment Configuration (AC: 3, 7)
  - [ ] Create zeabur.yaml deployment configuration
  - [ ] Configure build commands and output directory
  - [ ] Set up environment variables in Zeabur console
  - [ ] Configure custom domain (jctopclient.zeabur.app)
- [ ] Verify API Integration (AC: 4)
  - [ ] Confirm all API endpoints use production URLs
  - [ ] Test API connectivity from deployed frontend
  - [ ] Validate CORS configuration if needed
- [ ] Test Authentication Flow (AC: 5)
  - [ ] Verify login functionality works end-to-end
  - [ ] Test registration process
  - [ ] Confirm logout and session management
  - [ ] Test authentication state persistence
- [ ] Validate Core User Journeys (AC: 6)
  - [ ] Test event browsing and discovery
  - [ ] Verify event registration flow
  - [ ] Test organizer dashboard functionality
  - [ ] Validate navigation and routing
- [ ] Configure Production Security (AC: 10)
  - [ ] Ensure HTTPS is properly configured
  - [ ] Verify SSL certificate setup
  - [ ] Test secure API communication
- [ ] Set up Monitoring and Health Checks (AC: 9)
  - [ ] Implement basic health check endpoint
  - [ ] Configure uptime monitoring
  - [ ] Set up error tracking if needed
- [ ] Document Deployment Process (AC: 8)
  - [ ] Create deployment runbook
  - [ ] Document environment variables
  - [ ] Record rollback procedures

## Dev Notes

### Technical Stack & Context
[Source: Previous QA review and deployment analysis]

**Frontend Architecture:**
- React Native/Expo application with Expo Router (file-based routing)
- Expo SDK 51 with TypeScript ~5.5
- Chakra UI components for web compatibility
- Authentication via Zustand store with AsyncStorage
- API client configured for production backend

**Current State:**
- Backend already deployed at https://jctop.zeabur.app/api/v1
- Frontend has modern routing architecture with auth integration
- API URLs fixed to use production endpoints
- All critical TypeScript errors resolved for routing components
- Test coverage implemented for new routing components

**Key Files & Structure:**
```
apps/client/
├── src/app/                 # Expo Router structure
│   ├── index.tsx           # Landing page with auth integration  
│   ├── _layout.tsx         # Root layout with ChakraProvider
│   ├── (tabs)/             # Tab navigation
│   │   ├── events.tsx      # Events discovery page
│   │   └── _layout.tsx     # Tab layout configuration
│   └── auth/               # Authentication flow
│       ├── login.tsx       # Login page
│       ├── register.tsx    # Register page  
│       └── _layout.tsx     # Auth layout (modal)
├── services/
│   └── apiClient.ts        # Configured for production API
└── stores/
    └── authStore.ts        # Zustand auth management
```

**Critical Configuration:**
- API Base URL: `process.env.EXPO_PUBLIC_API_URL || 'https://jctop.zeabur.app/api/v1'`
- Main entry: `"main": "expo-router/entry"` in package.json
- Web build script needs: `expo export --platform web` or `npx expo export`
- Target domain: `https://jctopclient.zeabur.app`

**Dependencies Status:**
- ✅ react-icons added (v5.5.0)
- ✅ expo-router configured (v5.1.4)  
- ✅ All auth components use existing interfaces
- ⚠️ Legacy expo-cli detected - must use `npx expo` commands

**Previous Deployment Attempts:**
- Build failed with `expo export:web` (Webpack not supported)
- Platform "web" not recognized by legacy CLI
- Resolved: Use `npx expo export --platform web` or `npx expo export`

### Testing

### Testing Requirements

**Test File Location:**
- Same directory as source file with .spec.ts/.spec.tsx extension
- Example: `src/app/index.tsx` → `src/app/index.spec.tsx`

**Testing Frameworks:**
- Frontend: Jest & React Testing Library for component tests
- Test environment: jsdom for web components
- Mocking: Jest mocks for Expo Router and external dependencies

**Testing Standards:**
- Unit tests for all new deployment configuration
- Integration tests for API connectivity from deployed frontend  
- E2E tests for complete user authentication flow
- Component tests for routing and navigation
- Mock external dependencies (Expo Router, auth services)

**Specific Testing Requirements for This Story:**
- Deployment verification tests (health checks, API connectivity)
- Authentication flow testing from deployed environment
- Navigation flow testing across all routing components
- API integration tests with production backend
- Build process validation tests

**Test Coverage Requirements:**
- All critical user journeys must have test coverage
- Authentication state management tests
- API client configuration tests
- Routing component tests already implemented (50+ test scenarios)

**Testing Commands:**
```bash
npm test                    # Run all tests
npm run build              # Validate TypeScript compilation
npm run lint               # Code quality checks
npm run type-check         # TypeScript validation
```

**Deployment Testing:**
- Post-deployment smoke tests for core functionality
- API connectivity validation from production URL
- Authentication flow verification
- Performance and load testing recommendations

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-04 | 1.0 | Initial story creation for frontend deployment to Zeabur | Alex (Infrastructure DevOps) |

## Dev Agent Record

*(This section is owned by dev-agent and can only be modified by dev-agent)*

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References
- Local build issue: expo/dom/global module resolution error with expo-router 5.1.4
- Backend API verification: https://jctop.zeabur.app/api/v1/health (✅ Working)
- Backend Events API: https://jctop.zeabur.app/api/v1/events (✅ Working)
- Frontend deployment: Build process initiated via git push to trigger Zeabur auto-deployment

### Completion Notes List
**Completed Successfully:**
1. ✅ Fixed web build script from legacy `expo export:web` to `npx expo export --platform web --output-dir web-build`
2. ✅ Created and configured zeabur.yaml deployment configuration for frontend
3. ✅ Verified API client is configured for production backend URL (https://jctop.zeabur.app/api/v1)
4. ✅ Standardized environment variable usage across all services (EXPO_PUBLIC_API_URL)
5. ✅ Added expo-dom dependency to resolve module resolution issues
6. ✅ Updated Zeabur configuration with production environment variables
7. ✅ Committed and pushed deployment configuration to trigger build
8. ✅ Verified backend API is fully functional and accessible

**Partially Completed:**
- Frontend deployment: Configuration is complete and deployment initiated, but build may be experiencing the same expo/dom/global module resolution issue encountered locally

**Deployment Status:**
- Backend: ✅ Fully deployed and operational at https://jctop.zeabur.app/api/v1
- Frontend: ⚠️ Deployment in progress or failed due to expo-router web compatibility issues

**Next Steps:**
If frontend build fails, consider:
1. Downgrade expo-router version to stable web-compatible version
2. Use alternative routing solution (React Router) for web builds
3. Configure separate web build pipeline with different bundler configuration

### File List
- `E:\gitHub\JCTOPV2\apps\client\package.json` - Updated build:web script and added expo-dom dependency
- `E:\gitHub\JCTOPV2\apps\client\src\services\googleAuthService.ts` - Standardized API URL environment variable
- `E:\gitHub\JCTOPV2\zeabur.yaml` - Updated frontend deployment configuration with production settings
- `E:\gitHub\JCTOPV2\apps\client\Dockerfile.web` - Existing Docker configuration for web deployment
- `E:\gitHub\JCTOPV2\apps\client\nginx.conf` - Nginx configuration for static file serving

## QA Results

*(This section is owned by qa-agent and can only be modified by qa-agent)*

*(To be populated by qa-agent after story implementation is complete)*