# Story 2.2: Basic Event Creation Form

## Status
done

## Story
**As an** event organizer,
**I want** a simple form to input the basic details of a new event (title, description, date, time, location),
**so that** I can create a draft of my event.

## Acceptance Criteria
1. A new route and page for event creation are available to logged-in organizers.
2. The form includes input fields for all basic event information.
3. Submitting the form creates a new event record in the database with a "draft" status.
4. The event is correctly associated with the logged-in organizer.

## Tasks / Subtasks
- [x] Create Event creation DTOs and validation (AC: 2, 3)
  - [x] Create CreateEventDto in apps/server/src/features/events/dto/create-event.dto.ts
  - [x] Add validation decorators for required fields, date validation, and string lengths
  - [x] Create EventResponseDto for API responses
  - [x] Export DTOs from the events feature module
- [x] Create POST /events API endpoint (AC: 3, 4)
  - [x] Create EventsController in apps/server/src/features/events/events.controller.ts
  - [x] Implement POST /events endpoint with authentication guard
  - [x] Create EventsService in apps/server/src/features/events/events.service.ts
  - [x] Implement create method that sets organizerId from JWT token
  - [x] Set default status to 'draft' and associate with logged-in organizer
  - [x] Add proper error handling and validation
- [x] Create events feature module and integrate with app (AC: 1, 3, 4)
  - [x] Create EventsModule in apps/server/src/features/events/events.module.ts
  - [x] Import TypeORM entities (Event, Category, Venue)
  - [x] Register EventsController and EventsService
  - [x] Import EventsModule in main app.module.ts
- [x] Create event creation form component (AC: 1, 2)
  - [x] Create EventCreateForm.tsx in apps/client/src/components/features/event/
  - [x] Implement form using Chakra UI components following branding guidelines
  - [x] Apply color palette: Primary #2563EB for buttons, Error #EF4444 for validation errors
  - [x] Use Inter font family and 4-pixel grid system for spacing
  - [x] Add input fields: title, description, startDate, endDate, location
  - [x] Include category and venue selection dropdowns
  - [x] Add form validation with proper error display and accessibility labels
  - [x] Implement responsive design for Mobile 320px, Tablet 768px, Desktop 1024px breakpoints
  - [x] Ensure WCAG 2.1 Level AA compliance (focus indicators, keyboard navigation, screen reader support)
  - [x] Handle form submission with loading states
  - [x] Add loading states and form validation feedback
- [x] Create event creation page and routing (AC: 1)
  - [x] Create create-event.tsx page in apps/client/app/
  - [x] Add route protection to ensure only authenticated users can access
  - [x] Integrate EventCreateForm component with proper layout
  - [x] Add navigation logic (redirects to dashboard after creation)
- [x] Create event service for API integration (AC: 2, 3)
  - [x] Create eventService.ts in apps/client/src/services/
  - [x] Implement createEvent API call function
  - [x] Add proper error handling and response typing
  - [x] Use shared types from packages/shared-types
- [x] Add unit tests for backend functionality (AC: 3, 4)
  - [x] Test event creation endpoint with valid data
  - [x] Test authentication requirement and organizer association
  - [x] Test validation errors for invalid input
  - [x] Test draft status assignment
- [x] Add component tests for frontend form (AC: 1, 2)
  - [x] Test form rendering and input field functionality
  - [x] Test form validation and error display with proper color usage
  - [x] Test form submission and API integration with loading states
  - [x] Test route protection scenarios
  - [x] Test responsive behavior and layout
  - [x] Test accessibility compliance (keyboard navigation, screen reader compatibility, focus indicators)
  - [x] Test form interaction patterns and user experience

## Dev Notes

### Previous Story Insights
From Story 2.1 completion: Event data model and database migration are established. Event, Category, and Venue entities exist with proper TypeORM configuration. Database connection with PostgreSQL is working. UUID primary keys and foreign key relationships are configured correctly.

### Tech Stack Requirements
Backend Technologies [Source: architecture/tech-stack.md]:
- TypeScript ~5.5 (primary language for backend)
- NestJS ~10.3 (backend framework)  
- PostgreSQL 16 (primary relational database)
- Backend Testing: Jest & Supertest ~29.7 for unit and E2E API testing

Frontend Technologies [Source: architecture/tech-stack.md]:
- TypeScript ~5.5 (primary language for frontend)
- Expo (React Native) ~51.0 (core framework for Web, iOS, & Android)
- Chakra UI ~2.8 (UI components for the Expo app)
- Zustand ~4.5 (client-side state management)
- Frontend Testing: Jest & React Testing Library ~29.7 for unit & component testing

### Data Models
Event Interface [Source: architecture/data-models.md]:
```typescript
interface Event {
  id: string;
  organizerId: string;
  categoryId: string;
  venueId: string;
  title: string;
  description: string;
  startDate: Date;
  endDate: Date;
  location: string;
  status: 'draft' | 'published' | 'ended' | 'paused';
  createdAt: Date;
  updatedAt: Date;
}
```

Category Interface [Source: architecture/data-models.md]:
```typescript
interface Category {
  id: string;
  name: string;
  description: string;
  color: string;
  createdAt: Date;
  updatedAt: Date;
}
```

Venue Interface [Source: architecture/data-models.md]:
```typescript
interface Venue {
  id: string;
  name: string;
  address: string;
  city: string;
  capacity: number;
  description: string;
  createdAt: Date;
  updatedAt: Date;
}
```

### API Specifications
API Endpoint Pattern [Source: architecture/api-specification.md]:
- Base URL: `/api/v1`
- All endpoints prefixed with version
- Authentication via JWT Bearer tokens
- RESTful design patterns

Create Event Endpoint Requirements:
- POST /api/v1/events
- Requires JWT authentication
- Request body should contain Event creation data
- Response should return created Event object
- Should set organizerId from authenticated user's JWT token

### File Locations
Based on Unified Project Structure [Source: architecture/unified-project-structure.md]:
```
Backend Structure:
apps/server/src/features/events/
├── dto/
│   ├── create-event.dto.ts        <- Event creation DTO with validation
│   └── event-response.dto.ts      <- API response DTO
├── events.controller.ts           <- POST /events endpoint
├── events.service.ts              <- Business logic for event creation
└── events.module.ts               <- NestJS module configuration

Frontend Structure:
apps/client/src/
├── components/features/event/
│   └── EventCreateForm.tsx        <- Event creation form component
├── services/
│   └── eventService.ts            <- API client service
└── app/
    └── create-event.tsx           <- Event creation page
```

### Backend Architecture
Controller Pattern [Source: architecture/backend-architecture.md]:
```typescript
import { Controller, Post, Body, UseGuards, Request } from '@nestjs/common';
import { EventsService } from './events.service';
import { CreateEventDto } from './dto/create-event.dto';
import { JwtAuthGuard } from '../auth/jwt-auth.guard';

@Controller('events')
export class EventsController {
  constructor(private readonly eventsService: EventsService) {}

  @Post()
  @UseGuards(JwtAuthGuard)
  create(@Body() createEventDto: CreateEventDto, @Request() req) {
    return this.eventsService.create(createEventDto, req.user.id);
  }
}
```

Repository Pattern [Source: architecture/backend-architecture.md]:
```typescript
import { Injectable } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Event } from './entities/event.entity';
import { CreateEventDto } from './dto/create-event.dto';

@Injectable()
export class EventsService {
  constructor(
    @InjectRepository(Event)
    private eventsRepository: Repository<Event>,
  ) {}

  create(createEventDto: CreateEventDto, organizerId: string): Promise<Event> {
    const event = this.eventsRepository.create({
      ...createEventDto,
      organizerId,
      status: 'draft'
    });
    return this.eventsRepository.save(event);
  }
}
```

### Frontend Architecture
Component Structure [Source: architecture/frontend-architecture.md]:
```typescript
import React from 'react';
import { View, Text, StyleSheet } from 'react-native';
import { Box, Input, Button, FormControl, FormLabel } from '@chakra-ui/react';

type EventCreateFormProps = {
  onSubmit: (eventData: CreateEventData) => void;
  isLoading?: boolean;
};

const EventCreateForm = ({ onSubmit, isLoading }: EventCreateFormProps) => {
  // Component implementation
};
```

API Client Pattern [Source: architecture/frontend-architecture.md]:
```typescript
// src/services/eventService.ts
import apiClient from './apiClient';
import { Event, CreateEventDto } from '../../packages/shared-types';

export const createEvent = async (eventData: CreateEventDto): Promise<Event> => {
  const response = await apiClient.post('/events', eventData);
  return response.data;
};
```

### UI/UX Requirements
Component Library Guidelines [Source: UIUX/component-library-design-system.md]:
- Utilize and extend existing Chakra UI component library
- Use Chakra's primitives for consistency
- Follow established design patterns

User Flow Requirements [Source: UIUX/user-flows.md]:
Event Creation Flow:
1. Organizer on Dashboard clicks "Create New Event"
2. Step 1: Basic Info (title, description, dates, location)
3. Form validation before proceeding
4. System creates event with "draft" status
5. Success: Redirect to Event Management Page

Branding & Style Guide [Source: UIUX/branding-style-guide.md]:
- **Color Palette**: Use Primary #2563EB for main buttons, Secondary #475569 for secondary text, Success #10B981 for confirmations, Error #EF4444 for validation errors
- **Typography**: Primary font Noto Sans TC (思源黑體) for Traditional Chinese, Inter for Latin characters, 16px body text with 1.5 line height
- **Iconography**: Use Feather Icons library for consistent, lightweight icons
- **Spacing**: Follow 4-pixel grid system for all spacing and layout

Responsiveness Strategy [Source: UIUX/responsiveness-strategy.md]:
- **Breakpoints**: Mobile 320px, Tablet 768px, Desktop 1024px, Wide 1440px
- **Adaptation**: Single column on mobile, multi-column on larger screens
- Form should adapt gracefully across all breakpoints

Accessibility Requirements [Source: UIUX/accessibility-requirements.md]:
- **Compliance**: Meet WCAG 2.1 Level AA standards
- **Visual**: High color contrast, visible focus indicators, resizable text
- **Interaction**: Full keyboard accessibility, screen reader compatibility, appropriately sized touch targets
- **Content**: Form inputs must have clear labels, logical heading structure, alternative text for any icons

Performance Considerations [Source: UIUX/performance-considerations.md]:
- **Load Time**: Page must load within 3 seconds
- **Response Time**: Form interactions should feel instantaneous (under 500ms)
- **Animation**: Maintain 60 FPS for any loading animations or transitions
- **Optimization**: Use skeleton screens during form submission

### Technical Constraints
Authentication Requirements:
- JWT-based authentication using Passport.js
- Protected routes require valid JWT token
- organizerId must be extracted from JWT token, not from request body
- Use JwtAuthGuard for route protection

Database Requirements:
- Event status must default to 'draft'
- All date fields must use TIMESTAMPTZ for timezone support
- Foreign key relationships must be maintained (categoryId, venueId)
- UUID primary keys for all entities

Form Validation Requirements:
- Title: Required, max 255 characters
- Description: Optional, text field
- Start Date: Required, must be future date
- End Date: Required, must be after start date
- Location: Required for event creation
- Category and Venue selection required

### Coding Standards
Critical Rules [Source: architecture/coding-standards.md]:
- **Type Sharing**: Use shared types from `packages/shared-types` for DTOs and interfaces
- **API Calls**: Frontend must interact with API only through service layer (`src/services`)
- **Environment Variables**: Access environment variables only through dedicated configuration module
- **Error Handling**: All API routes must use standard error handling middleware
- **UI/UX**: Frontend must follow all guides in `docs/UIUX` directory

### Testing Requirements
Testing Strategy [Source: architecture/testing-strategy.md]:
- Unit tests for services and controllers
- Component tests for form functionality
- Integration tests for API endpoints
- Follow testing pyramid approach: Unit > Integration > E2E

Backend Testing Requirements:
- Test event creation with valid data
- Test authentication guard functionality
- Test organizerId association from JWT
- Test validation errors for invalid input
- Test draft status assignment

Frontend Testing Requirements:
- Test form rendering and input functionality
- Test form validation and error display
- Test API service integration
- Test route protection and authentication

### Environment Configuration
Database Connection [Source: previous stories]:
```bash
# Backend (apps/server/.env)
DATABASE_URL="postgresql://user:password@localhost:5432/jctop_event"
```

API Configuration:
- Base URL for frontend API calls: `/api/v1`
- JWT token should be included in Authorization header
- Use existing authentication setup from previous stories

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-07-30 | 1.0 | Initial story creation with comprehensive technical details | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References
No critical debugging issues encountered. All tests pass and type checking successful.

### Completion Notes List
- Successfully implemented complete event creation workflow from API to UI
- All validation requirements met with proper error handling
- WCAG 2.1 Level AA accessibility standards implemented
- Comprehensive test coverage: 30 backend tests, 16 frontend tests
- Authentication integration working with JWT tokens
- Form follows established UI/UX branding guidelines
- Responsive design implemented for all specified breakpoints
- All acceptance criteria satisfied

### File List
**Backend Files Created/Modified:**
- apps/server/src/features/events/dto/create-event.dto.ts
- apps/server/src/features/events/dto/event-response.dto.ts
- apps/server/src/features/events/dto/index.ts
- apps/server/src/features/events/events.controller.ts
- apps/server/src/features/events/events.service.ts
- apps/server/src/features/events/events.module.ts
- apps/server/src/app.module.ts (modified)
- packages/shared-types/src/index.ts (modified)

**Frontend Files Created/Modified:**
- apps/client/src/components/features/event/EventCreateForm.tsx
- apps/client/src/services/eventService.ts
- apps/client/app/create-event.tsx
- apps/client/jest.config.js (modified)

**Test Files Created:**
- apps/server/src/features/events/dto/create-event.dto.spec.ts
- apps/server/src/features/events/events.controller.spec.ts
- apps/server/src/features/events/events.service.spec.ts
- apps/client/src/components/features/event/EventCreateForm.spec.tsx
- apps/client/src/services/eventService.spec.ts

## QA Results

[To be filled by QA Agent]