apiVersion: zeabur.com/v1
kind: Template
metadata:
  name: JCTOP-Complete-Stack
spec:
  description: JCTOP Event Management System with Prebuilt Images
  icon: https://raw.githubusercontent.com/zeabur/service-icons/main/marketplace/nestjs.svg
  tags:
    - NestJS
    - Expo
    - PostgreSQL
    - Monorepo
  services:
    # PostgreSQL Database
    - name: postgres-db
      template: PREBUILT
      spec:
        source:
          image: postgres:16-alpine
        ports:
          - id: database
            port: 5432
            type: TCP
        volumes:
          - id: data
            dir: /var/lib/postgresql/data
        env:
          POSTGRES_USER:
            default: jctop
            expose: true
          POSTGRES_PASSWORD:
            generate: PASSWORD
            expose: true
          POSTGRES_DB:
            default: jctop
            expose: true
          PGDATA:
            default: /var/lib/postgresql/data/pgdata

    # Backend API Service (Prebuilt)
    - name: backend-api
      template: PREBUILT
      spec:
        source:
          image: golfamigo/jctopv2-backend:latest
        ports:
          - id: web
            port: 3000
            type: HTTP
        env:
          DATABASE_URL:
            default: postgresql://${postgres-db.POSTGRES_USER}:${postgres-db.POSTGRES_PASSWORD}@postgres-db:5432/${postgres-db.POSTGRES_DB}
          JWT_SECRET:
            generate: PASSWORD
          ENCRYPTION_SECRET_KEY:
            default: abcdefghijklmnopqrstuvwxyz123456
          NODE_ENV:
            default: production
          CORS_ORIGIN:
            default: https://${frontend-web.ZEABUR_WEB_URL}

    # Frontend Web Service (Prebuilt)
    - name: frontend-web
      template: PREBUILT
      spec:
        source:
          image: golfamigo/jctopv2-frontend:latest
        ports:
          - id: web
            port: 80
            type: HTTP
        env:
          EXPO_PUBLIC_API_URL:
            default: https://${backend-api.ZEABUR_WEB_URL}/api/v1
          NODE_ENV:
            default: production